{% extends 'base.html' %}


{%block title%}
HistMat | {{book.title}}
{% endblock %}

{% load static %}
{% block js%}

    {% csrf_token %}
    <script type="text/javascript">     window.CSRF_TOKEN = "{{ csrf_token }}"; </script> 
    <script src="{% static 'js/Biblio/general.js' %}"> </script>
    <script src="{% static 'js/Biblio/widgets.js' %}"> </script>
    <script src="{% static 'js/Biblio/book_detail.js' %}"> </script>

    {% if user.is_authenticated %}
    <script>
        var fab = new Vue({
            el: '#fab-container',
            data: {
                update_url: "{% url 'biblio:book_update' book.slug%}"
            },
            methods: {
                fab_action: function (event) {
                    window.location = this.update_url;
                }
            }
        })
    </script>
    {% endif %}
{% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/widgets/rating.css' %}">    
    {% if user.is_authenticated %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/widgets/fab.css' %}">  
    {% endif %}
{% endblock %}

{% block content %}
<div class="p-5">
    <div class="card container-fluid bg-light shadow p-5">
        <div class="row">
            <!-- Left Sector -->
            <div class="col">
                <div class="row">
                    {%if book.cover%}
                        <img src="{{book.cover.url}}" class="img-fluid" alt="{{book.title}} cover">

                     {% else %}
                     {% load static %}
                        <img src="/HistMat/media/no_image.jpg" alt="{{book.title}} cover" class="img-fluid">
                    {%endif%}
                </div>
                <div class="row pt-2">
                    {% if book.book_file%}
                        <a class="btn w-100 btn-success" href="{{book.book_file.url}}"> Book File </a>
                    {% else %}
                        <a class="btn w-100 btn-success disabled" > Book File </a>
                    {% endif %}
                    
                </div>
            </div>

            <!-- Middle Sector -->
            <div class="col-6">
                <h1>{{book.title}}</h1>
                <p> Escrito por {{book.author}}</p>
                <p> {{book.description}}</p>

                <div class="card">
                    <p> {{book.npages}} paginas</p>
                </div>
            </div>
            <!-- Right Sector -->
            <div class="col">
                <div class="row">
                    {% include 'Biblio/widgets/shelf_dropdown_p.html' with book=book %}
                </div>
                <div class="row d-flex flex-column card p-3">
                    <div>
                        {% if user.is_authenticated %}
                            {%load book_access%}
                            {% is_book_in_user user book as book_user_related %}

                            {% if book_user_related %}
                            <form method="POST" id="star-rating" action="?">
                                {%csrf_token%}
                                <div class="rating"> 
                                    <!-- https://stackoverflow.com/questions/1107737/numeric-for-loop-in-django-templates -->
                                    {% for i in '54321'|make_list %}
                                        <!-- https://bbbootstrap.com/snippets/star-rating-pure-css-19646372 -->
                                        <input type="radio" name="rating_v" value="{{ i }}" id="rating-{{ i }}">
                                        <label for="rating-{{ i }}">☆</label> 
                                    {% endfor %}
                                </div>
                            </form>
                            {% endif %}
                        {% endif %}
                    <!-- Rating -->
                    </div>
                    <div class="d-flex justify-content-center">
                        <span >El libro tiene una puntuación de {{ rating.total }}.</span>
                    </div>
                    
                </div>
                <div class="row card p-3 mt-2">
                    {% if user.is_authenticated %}
                        {%load book_access%}
                        {% is_book_in_user user book as book_user_related %}

                        {% if book_user_related %}
                            {% is_book_act_page_in_user user book as act_book_page %}
                            <div class="d-flex justify-content-center">
                                <p> Actual page </p>
                            </div>
                            
                            <input id="set-act-page" type="input" b_slug = "{{book.slug}}" placeholder="{{act_book_page}}">
                        {% else %}
                            <p>You should consider adding this book to be able to track your progess!</p>
                        {% endif %}
                    {% else %}
                        <p>To add and track books you should register!</p>
                    {% endif %}
                </div>
            </div>
            
            
            
        </div>
    </div>    
</div>

{% if book.creator == request.user %}
    {% include 'widgets/fab.html' with icon="fa-cog"%}
{% endif %}

{% endblock %}