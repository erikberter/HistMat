{% extends 'base.html' %}

{% block title %} HistMat | Forum {% endblock %}

{% load static %}

{% block css%}
	<link rel="stylesheet" type="text/css" href="{% static 'css/widgets/fab.css' %}">  
{% endblock %}

{% block js%}

<script>
	var fab = new Vue({
		el: '#fab-container',
		data: {
			//Data
			create_url: "{% url 'forum:add_post' %}"
		},
		methods: {
			fab_action: function (event) {
				//Action
				window.location = this.create_url;
			}
		}
	})
</script>

<script>
	$(document).ready(function(){

		
		document.cookie='name=User';
		console.log(document.cookie);

		//Ejemplo de Cookie: name=User; csrftoken=nqLcmxZ2TkN90ZmNSvr3cjKybkyrDWaJPhDW1xTVwN7ueHSUCnNpcyLrk0EkdJhy

		function getCookie(name) {
			var cookieValue = null;

			if (document.cookie && document.cookie !== '') {
				var cookies = document.cookie.split(';');

				for (var i = 0; i < cookies.length; i++) {
					var cookie = cookies[i].trim();

					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		};

		var csrfToken = getCookie('csrftoken')

		$.ajaxSetup({
			beforeSend: function(xhr) {
				xhr.setRequestHeader("X-CSRFToken", csrfToken);
			}
		})

		$(".like-button").click(function(){
			let pk  = $(this).attr('pk');
			$.ajax({
				type: "POST",
				url: "post_detail/" + pk + "/upvote",
				dataType:'json',
				data: {},
				success: function(result){
					$(".like-count-" + pk).text(parseInt($(".like-count-" + pk).text())+1);
				},
				error: function(result) {
					alert('error');
				}
			});
		});
	});
</script>
{% endblock %}

{% block content %} 
<div class="container">
	<div class="row justify-content-md-center align-items-center">
		{% for post in posts %}
			<div class="card d-flex p-3 my-2">
					<p> Posted by {{ post.user }} . {{ post.date }} </p>
					<h3>
						<a class="font-weight-bold" href="{{post.get_absolute_url}}">
							{{ post.body }}
						</a>
					</h3>
					<div>
						{% if post.image %}
							<a href="{{post.get_absolute_url}}">
								<img class="rounded" src="{{post.image.url}}" width="750">
							</a>
						{% else %}
							<p class="font-weight-bold my-3"> No image </p>
							<img src="/HistMat/static/img/blanco.jpg" width="750" height="1">
						{% endif %}
					</div>	
					<div class="col">
						<i class="fa fa-thumbs-up like-button mt-2" pk='{{post.pk}}'></i> 
						<span class="like-count-{{post.pk}} font-weight-bold">{{ post.likes }}</span> 
					</div>
				</div>
			
		{% endfor%}
	</div>
</div>
{% include 'widgets/fab.html'%}

{% endblock %}